<div class="card mb-3 post-card" data-post-id="{{ post.id }}">
  <div class="card-body">
    <h6>
      <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a>
      <small class="text-muted"> — {{ post.timestamp|date:"M d, Y H:i" }}</small>
    </h6>

    <div class="post-content" data-original="{{ post.content|escape }}">
      <p class="mb-2">{{ post.content|linebreaks }}</p>
    </div>

    <div class="d-flex align-items-center">
      <button class="btn btn-sm btn-outline-primary like-btn"
              data-liked="{% if post.id in liked_post_ids %}true{% else %}false{% endif %}">
        <span class="like-count">{{ post.likes_count }}</span> ♥
      </button>

      {% if request.user.is_authenticated and request.user == post.author %}
        <button class="btn btn-sm btn-outline-secondary ml-2 edit-btn">Edit</button>
      {% endif %}

      <button class="btn btn-sm btn-info ml-2 toggle-comments-btn">Comments</button>
    </div>

    <!-- Comments Section -->
    <div class="comments-section mt-3 d-none">
      <div class="existing-comments">
        {% for comment in post.comments.all %}
          <p><strong>{{ comment.author.username }}</strong>: {{ comment.content }}</p>
        {% empty %}
          <p class="text-muted">No comments yet.</p>
        {% endfor %}
      </div>

      {% if user.is_authenticated %}
        <form class="comment-form mt-2" data-post-id="{{ post.id }}">
          <input type="text" class="form-control form-control-sm comment-input" placeholder="Write a comment...">
          <button type="submit" class="btn btn-sm btn-primary mt-1">Comment</button>
        </form>
      {% else %}
        <p class="text-muted mt-2">Log in to comment.</p>
      {% endif %}
    </div>
  </div>
</div>
